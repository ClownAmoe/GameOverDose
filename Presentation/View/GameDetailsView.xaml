<UserControl x:Class="Presentation.Views.GameDetailsView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:vm="clr-namespace:Presentation.ViewModels"
             
             mc:Ignorable="d"
             d:DataContext="{d:DesignInstance vm:GameDetailsViewModel}"
             
             Background="#1C1C1C"
             d:DesignHeight="700" d:DesignWidth="1200">

	<UserControl.Resources>
		<BooleanToVisibilityConverter x:Key="BoolToVisibility"/>

		<Style TargetType="TextBlock">
			<Setter Property="Foreground" Value="#E0E0E0"/>
		</Style>

		<Style x:Key="SectionHeader" TargetType="TextBlock" BasedOn="{StaticResource {x:Type TextBlock}}">
			<Setter Property="FontSize" Value="18"/>
			<Setter Property="FontWeight" Value="Bold"/>
			<Setter Property="Foreground" Value="#FF3030"/>
			<Setter Property="Margin" Value="0,15,0,10"/>
		</Style>

		<Style x:Key="ActionButton" TargetType="Button">
			<Setter Property="Background" Value="#FF3030"/>
			<Setter Property="Foreground" Value="White"/>
			<Setter Property="Padding" Value="15,8"/>
			<Setter Property="FontSize" Value="14"/>
			<Setter Property="FontWeight" Value="Bold"/>
			<Setter Property="BorderThickness" Value="0"/>
			<Setter Property="Cursor" Value="Hand"/>
			<Setter Property="Template">
				<Setter.Value>
					<ControlTemplate TargetType="Button">
						<Border Background="{TemplateBinding Background}" CornerRadius="3">
							<ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
						</Border>
						<ControlTemplate.Triggers>
							<Trigger Property="IsMouseOver" Value="True">
								<Setter Property="Background" Value="#AA1010"/>
							</Trigger>
						</ControlTemplate.Triggers>
					</ControlTemplate>
				</Setter.Value>
			</Setter>
		</Style>

		<Style x:Key="GameTrackerButtonStyle" TargetType="Button" BasedOn="{StaticResource ActionButton}">
			<Setter Property="FontWeight" Value="SemiBold"/>
			<Setter Property="Padding" Value="20,10"/>
			<Setter Property="FontSize" Value="18"/>
			<Setter Property="Template">
				<Setter.Value>
					<ControlTemplate TargetType="Button">
						<Border x:Name="TrackerBorder" Background="{TemplateBinding Background}" CornerRadius="5">
							<StackPanel Orientation="Horizontal" HorizontalAlignment="Center" VerticalAlignment="Center" Margin="10,0">
								<ContentPresenter x:Name="IconContent" Margin="0,0,8,0"/>
								<ContentPresenter/>
							</StackPanel>
						</Border>
						<ControlTemplate.Triggers>
							<Trigger Property="IsMouseOver" Value="True">
								<Setter TargetName="TrackerBorder" Property="Opacity" Value="0.85"/>
							</Trigger>

							<DataTrigger Binding="{Binding IsTracking, FallbackValue=False}" Value="True">
								<Setter Property="Background" Value="#10AA10"/>
								<Setter Property="Content" Value="STOP TRACKING"/>
								<Setter TargetName="IconContent" Property="Content">
									<Setter.Value>
										<Path Fill="White" Width="14" Height="14" Data="M0,0 H10 V10 H0 Z"/>
									</Setter.Value>
								</Setter>
							</DataTrigger>
							<DataTrigger Binding="{Binding IsTracking, FallbackValue=False}" Value="False">
								<Setter Property="Background" Value="#FF3030"/>
								<Setter Property="Content" Value="START TRACKING"/>
								<Setter TargetName="IconContent" Property="Content">
									<Setter.Value>
										<Path Fill="White" Width="14" Height="14" Data="M0,0 L0,10 L8,5 Z"/>
									</Setter.Value>
								</Setter>
							</DataTrigger>
						</ControlTemplate.Triggers>
					</ControlTemplate>
				</Setter.Value>
			</Setter>
		</Style>

	</UserControl.Resources>

	<Grid Margin="30">
		<Grid.RowDefinitions>
			<RowDefinition Height="Auto"/>
			<RowDefinition Height="*"/>
		</Grid.RowDefinitions>

		<Grid Grid.Row="0" Margin="0,0,0,30">
			<Grid.ColumnDefinitions>
				<ColumnDefinition Width="*"/>
				<ColumnDefinition Width="Auto"/>
				<ColumnDefinition Width="Auto"/>
			</Grid.ColumnDefinitions>

			<TextBlock Grid.Column="0"
                       Text="{Binding CurrentGame.Title}"
                       FontSize="48"
                       FontWeight="ExtraBold"
                       Foreground="White"
                       TextTrimming="CharacterEllipsis"/>

			<Button Grid.Column="1"
                    Command="{Binding ToggleTrackingCommand}"
                    Margin="0,0,20,0"
                    HorizontalAlignment="Right"
                    Style="{StaticResource GameTrackerButtonStyle}"/>

			<Button Grid.Column="2"
                    Content="Follow Game"
                    Command="{Binding FollowCommand}"
                    Style="{StaticResource ActionButton}"/>
		</Grid>

		<Grid Grid.Row="1">
			<Grid.ColumnDefinitions>
				<ColumnDefinition Width="260"/>
				<ColumnDefinition Width="*"/>
				<ColumnDefinition Width="300"/>
			</Grid.ColumnDefinitions>

			<StackPanel Grid.Column="0" Margin="0,0,25,0">
				<Border Width="250" Height="330"
                        Background="#252525"
                        BorderBrush="#FF3030"
                        BorderThickness="1"
                        CornerRadius="5"
                        Margin="0,0,0,25">
					<Grid>
						<Image Source="{Binding CurrentGame.ImageSource}"
                               Stretch="Uniform"
                               HorizontalAlignment="Center"
                               VerticalAlignment="Center">
							<Image.Style>
								<Style TargetType="Image">
									<Setter Property="Visibility" Value="Visible"/>
									<Style.Triggers>
										<DataTrigger Binding="{Binding CurrentGame.ImageSource}" Value="">
											<Setter Property="Visibility" Value="Collapsed"/>
										</DataTrigger>
										<DataTrigger Binding="{Binding CurrentGame.ImageSource}" Value="{x:Null}">
											<Setter Property="Visibility" Value="Collapsed"/>
										</DataTrigger>
									</Style.Triggers>
								</Style>
							</Image.Style>
						</Image>

						<TextBlock Text="🎮"
                                   FontSize="72"
                                   VerticalAlignment="Center"
                                   HorizontalAlignment="Center"
                                   Foreground="#888888">
							<TextBlock.Style>
								<Style TargetType="TextBlock">
									<Setter Property="Visibility" Value="Collapsed"/>
									<Style.Triggers>
										<DataTrigger Binding="{Binding CurrentGame.ImageSource}" Value="">
											<Setter Property="Visibility" Value="Visible"/>
										</DataTrigger>
										<DataTrigger Binding="{Binding CurrentGame.ImageSource}" Value="{x:Null}">
											<Setter Property="Visibility" Value="Visible"/>
										</DataTrigger>
									</Style.Triggers>
								</Style>
							</TextBlock.Style>
						</TextBlock>
					</Grid>
				</Border>

				<TextBlock Text="Your Rating" Style="{StaticResource SectionHeader}"/>
				<StackPanel Orientation="Horizontal" Margin="0,0,0,15">
					<ItemsControl ItemsSource="{Binding RatingStars}">
						<ItemsControl.ItemsPanel>
							<ItemsPanelTemplate>
								<StackPanel Orientation="Horizontal"/>
							</ItemsPanelTemplate>
						</ItemsControl.ItemsPanel>
						<ItemsControl.ItemTemplate>
							<DataTemplate>
								<Button Command="{Binding DataContext.SetRatingCommand, RelativeSource={RelativeSource AncestorType={x:Type UserControl}}}"
                                        CommandParameter="{Binding Value}"
                                        Background="Transparent" BorderThickness="0" Padding="2" Margin="1,0">
									<TextBlock Text="★" FontSize="24" Foreground="{Binding Color}"/>
								</Button>
							</DataTemplate>
						</ItemsControl.ItemTemplate>
					</ItemsControl>
				</StackPanel>

				<TextBlock Text="Developers" Style="{StaticResource SectionHeader}"/>
				<ItemsControl ItemsSource="{Binding CurrentGame.Developers}">
					<ItemsControl.ItemTemplate>
						<DataTemplate>
							<TextBlock Text="{Binding}" Margin="0,2,0,2" Foreground="#C0C0C0"/>
						</DataTemplate>
					</ItemsControl.ItemTemplate>
				</ItemsControl>
			</StackPanel>

			<ScrollViewer Grid.Column="1" VerticalScrollBarVisibility="Auto" Margin="0,0,30,0">
				<StackPanel>

					<TextBlock Text="{Binding CurrentGame.Description}"
                               FontSize="15"
                               TextWrapping="Wrap"
                               Foreground="#C0C0C0"
                               Margin="0,0,0,25"/>

					<!-- ✅ СЕКЦІЯ ТРЕЙЛЕРА -->
					<StackPanel Visibility="{Binding HasTrailer, Converter={StaticResource BoolToVisibility}}">
						<TextBlock Text="Trailer/Gameplay"
                                   Style="{StaticResource SectionHeader}"
                                   Margin="0,0,0,15"/>

						<Border Height="400"
                                Background="#1a1a1a"
                                BorderBrush="#FF3030"
                                BorderThickness="2"
                                CornerRadius="5"
                                Margin="0,0,0,25">
							<StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
								<TextBlock Text="🎬"
                                           FontSize="72"
                                           HorizontalAlignment="Center"
                                           Margin="0,0,0,20"/>

								<TextBlock Text="{Binding CurrentGame.Title}"
                                           FontSize="20"
                                           FontWeight="Bold"
                                           Foreground="White"
                                           HorizontalAlignment="Center"
                                           Margin="0,0,0,10"/>

								<TextBlock Text="Офіційний трейлер"
                                           FontSize="14"
                                           Foreground="#999999"
                                           HorizontalAlignment="Center"
                                           Margin="0,0,0,30"/>

								<Button Content="▶️  Дивитись трейлер на YouTube"
                                        Click="OpenTrailerButton_Click"
                                        Background="#FF3030"
                                        Foreground="White"
                                        Padding="25,15"
                                        FontSize="18"
                                        FontWeight="Bold"
                                        BorderThickness="0"
                                        Cursor="Hand">
									<Button.Style>
										<Style TargetType="Button">
											<Setter Property="Template">
												<Setter.Value>
													<ControlTemplate TargetType="Button">
														<Border x:Name="border"
                                                                Background="{TemplateBinding Background}"
                                                                CornerRadius="8"
                                                                Padding="{TemplateBinding Padding}">
															<ContentPresenter HorizontalAlignment="Center"
                                                                              VerticalAlignment="Center"/>
														</Border>
														<ControlTemplate.Triggers>
															<Trigger Property="IsMouseOver" Value="True">
																<Setter TargetName="border" Property="Background" Value="#AA1010"/>
															</Trigger>
															<Trigger Property="IsPressed" Value="True">
																<Setter TargetName="border" Property="Background" Value="#CC2020"/>
															</Trigger>
														</ControlTemplate.Triggers>
													</ControlTemplate>
												</Setter.Value>
											</Setter>
										</Style>
									</Button.Style>
								</Button>

								<TextBlock Text="Відкриється в вашому браузері"
                                           FontSize="12"
                                           Foreground="#666666"
                                           HorizontalAlignment="Center"
                                           Margin="0,15,0,0"/>
							</StackPanel>
						</Border>
					</StackPanel>

					<TextBlock Text="User Reviews &amp; Discussion" Style="{StaticResource SectionHeader}"/>

					<Border Background="#101010" BorderBrush="#333333" BorderThickness="1" CornerRadius="5" Padding="15" Margin="0,0,0,15">
						<StackPanel>
							<TextBlock Text="Залиште свій відгук" FontWeight="SemiBold" FontSize="16" Margin="0,0,0,10"/>

							<TextBox Text="{Binding NewCommentText, Mode=TwoWay}"
                                     Height="80"
                                     TextWrapping="Wrap"
                                     AcceptsReturn="True"
                                     VerticalScrollBarVisibility="Auto"
                                     Background="#252525"
                                     Foreground="#E0E0E0"
                                     Padding="8"
                                     Margin="0,0,0,10"/>

							<StackPanel Orientation="Horizontal" Margin="0,0,0,10">
								<TextBlock Text="Ваша оцінка:" VerticalAlignment="Center" Margin="0,0,10,0"/>
								<ItemsControl ItemsSource="{Binding RatingStars}">
									<ItemsControl.ItemsPanel>
										<ItemsPanelTemplate>
											<StackPanel Orientation="Horizontal"/>
										</ItemsPanelTemplate>
									</ItemsControl.ItemsPanel>
									<ItemsControl.ItemTemplate>
										<DataTemplate>
											<Button Command="{Binding DataContext.SetRatingCommand, RelativeSource={RelativeSource AncestorType={x:Type UserControl}}}"
                                                    CommandParameter="{Binding Value}"
                                                    Background="Transparent"
                                                    BorderThickness="0"
                                                    Padding="2"
                                                    Margin="1,0"
                                                    Cursor="Hand">
												<TextBlock Text="★" FontSize="20" Foreground="{Binding Color}"/>
											</Button>
										</DataTemplate>
									</ItemsControl.ItemTemplate>
								</ItemsControl>
							</StackPanel>

							<Button Content="Опублікувати"
                                    Command="{Binding PostCommentCommand}"
                                    Style="{StaticResource ActionButton}"
                                    HorizontalAlignment="Right"/>
						</StackPanel>
					</Border>

					<ItemsControl ItemsSource="{Binding Comments}">
						<ItemsControl.ItemTemplate>
							<DataTemplate>
								<Border BorderBrush="#333333" BorderThickness="0,0,0,1" Padding="0,10,0,15" Margin="0,0,0,10">
									<StackPanel>
										<Grid>
											<Grid.ColumnDefinitions>
												<ColumnDefinition Width="*"/>
												<ColumnDefinition Width="Auto"/>
											</Grid.ColumnDefinitions>
											<StackPanel Grid.Column="0" Orientation="Horizontal">
												<TextBlock Text="{Binding Author}" FontWeight="Bold" Foreground="#FF3030" Margin="0,0,10,0"/>
												<TextBlock Text="{Binding Rating, StringFormat='★ {0}/10'}" Foreground="#FFC830"/>
											</StackPanel>
											<TextBlock Grid.Column="1" Text="{Binding Date, StringFormat='dd MMM yyyy'}" FontSize="12" Foreground="#888888"/>
										</Grid>
										<TextBlock Text="{Binding Text}" TextWrapping="Wrap" Margin="0,8,0,0" Foreground="#C0C0C0"/>
									</StackPanel>
								</Border>
							</DataTemplate>
						</ItemsControl.ItemTemplate>
					</ItemsControl>
				</StackPanel>
			</ScrollViewer>

			<StackPanel Grid.Column="2">
				<TextBlock Text="Price History" Style="{StaticResource SectionHeader}"/>
				<Border Height="250"
                        Background="#080808"
                        BorderBrush="#FF3030"
                        BorderThickness="1"
                        CornerRadius="5">
					<TextBlock Text="📊 Chart"
                               FontSize="36"
                               VerticalAlignment="Center"
                               HorizontalAlignment="Center"
                               Foreground="#AA1010"/>
				</Border>
				<TextBlock Margin="0,15,0,25" FontSize="24" FontWeight="Bold">
					<Run Text="Current Price: " Foreground="#E0E0E0"/>
					<Run Text="{Binding CurrentGame.Price, StringFormat=C2}" Foreground="#FF3030"/>
				</TextBlock>

				<TextBlock Text="Achievements" Style="{StaticResource SectionHeader}"/>
				<TextBlock Text="Coming soon..." Margin="0,0,0,10" Foreground="#C0C0C0"/>
			</StackPanel>
		</Grid>
	</Grid>
</UserControl>